<!doctype html>
<html lang="en">
  <head>
    <base href="https://webapi.amap.com/ui/1.0/ui/overlay/SvgMarker/examples/" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" type="text/css">
    <!-- <link rel="stylesheet" href="../css/geoStyle.css" type="text/css"> -->
    <style>
       .icon {
           width: 1em; height: 1em;
           vertical-align: -0.15em;
           fill: currentColor;
           overflow: hidden;
        }

      html,body,#container{
        height: 100%
      }
      .input-item{
        height: 2.2rem;
      }
      .btn{
        width: 6rem;
        margin: 0 1rem 0 2rem;
      }
      .input-text{
        width: 4rem;
        margin-right:1rem;
      }

      #map-styles .input-item {
        height: 2rem;
      }

      #map-styles .input-item span{
        display: inline-block;
        width: 4rem;
      }

      #map-styles .input-item .input-text {
        color: #0288d1;
        margin-left: 1rem;
        margin-right: 0rem;
        width: 6rem;
      }

      .imgstyle{
        width: 22px;
        height: 23px;
      }
      /* 滑动特效 */
     .background{
        position: fixed;
        bottom: 36rem;
        right: 1rem;
      }
      .legend{
        font-size: 16px;
        color:#3399FF;
      }
    </style>
    <title>绘制地图</title>
  </head>
  <body>
    <!-- 地图 -->
    <div id='container'></div>
    <!-- MouseTool绘制 -->
    <div class="input-card" style='width: 24rem;'>
        <div class="input-item">
          <input type="radio" name='func'  value='定位' class="radioBtn">
          <span class="input-text">
            <svg class="icon legend" aria-hidden="true">
                <use xlink:href="#icon-reyuan-"></use>
            </svg>
          </span>
          <input type="radio" name='func'  value='井室' class="radioBtn">
          <span class="input-text">
            <svg class="icon legend" aria-hidden="true">
                <use xlink:href="#icon-start-copy"></use>
            </svg>
          </span>
          <input type="radio" name='func'  value='阀门' class="radioBtn">
          <span class="input-text">
             <svg class="icon legend" aria-hidden="true">
                <use xlink:href="#icon-transform"></use>
            </svg>
          </span>
        </div>
        <div class="input-item">
          <input type="radio" name='func' value='一级'  class="radioBtn">
          <span class="input-text">
            <svg class="icon legend" aria-hidden="true">
                <use xlink:href="#icon-zhixian"></use>
            </svg>
          </span>
          <input type="radio" name='func' value='二级'  class="radioBtn">
          <span class="input-text">
            <svg class="icon legend" aria-hidden="true">
                <use xlink:href="#icon-xuxian"></use>
            </svg>
          </span>
        </div>
        <div class="input-item">
            <input id="clear" type="button" class="btn" value="清除" />
            <input id="close" type="button" class="btn" value="关闭绘图" />
        </div>
    </div>
    <!-- 换肤normal-->
    <div class="background input-card" style="width:15rem">
        <div id="map-styles">
          <div class="input-item"><input type='radio' name='mapStyle' value='whitesmoke'><span>远山黛</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='grey' checked><span>雅士灰</span></div>
        </div>
    </div>
    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>

	  <script type="text/javascript" src='https://webapi.amap.com/maps?v=1.4.15&key=486bdaf9ff24488ff9064da3f3da77b1'></script>
    <!-- UI组件库 1.0 -->
    <script src="https://webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>

    <!-- <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script> -->
    <!-- <script src="../js/jquery-3.4.1.min.js"></script> -->

    <script type="text/javascript">
    // =====================创建地图======================
    var map = new AMap.Map('container',{
        zoom: 13,
        center: [116.53381,39.88339],
        resizeEnable: true,
        mapStyle: "amap://styles/grey" ,//地图换肤

    });

    //SvgMarker
    var svgPosition={}
    var svgStyle = {
        symbolJs: '//at.alicdn.com/t/font_1209716_mowibqmgf5.js',
        icon: 'icon-reyuan-',
        size: 25,
        offset: [-12.5, -12.5],
        fillColor: '#3399FF'
    };
    function  svgMarker(type){
      AMapUI.loadUI(['overlay/SvgMarker'], function(SvgMarker) {
          if (!SvgMarker.supportSvg) {
              alert('当前环境不支持SVG');
          }
          //判断
          switch(type){
            case '定位':{
                svgStyle.icon = 'icon-reyuan-';
                var marker1 = new SvgMarker(new SvgMarker.Shape.IconFont(svgStyle), svgPosition);
                marker1.on('click', markerClick);
                break;
            }
            case '井室':{
                svgStyle.icon = 'icon-start-copy';
                var marker2 = new SvgMarker(new SvgMarker.Shape.IconFont(svgStyle),svgPosition);
                marker2.on('click', markerClick);
                break;
            }
            case '阀门':{
                svgStyle.icon = 'icon-transform';
                var marker3 = new SvgMarker(new SvgMarker.Shape.IconFont(svgStyle),svgPosition);
                marker3.on('click', markerClick);
                break;
            }
          }
      });
    }
    //页面加载调用函数生成图标
    svgMarker('定位');
    //====================为地图换肤=======================
    //绑定radio点击事件
    var radios = document.querySelectorAll("#map-styles input");
    radios.forEach(function(ratio) {
      ratio.onclick = setMapStyle;
    });
    function setMapStyle(){
      var styleName = "amap://styles/" + this.value;
      map.setMapStyle(styleName);
    }

    //=====================鼠标绘制工具=====================
    //定义全局存放设备位置的数组
    var solidpolylineArr = []; //一级管网
    var dashedpolylineArr = []; //二级管网

    //获取要绘制的类型
    var radios = document.getElementsByName('func');
    var equipmentPosition;
    var drawType;
    for(var i=0;i<radios.length;i+=1){
        radios[i].onchange = function(e){
            drawType = e.target.value;
            //获取在地图上鼠标点击的坐标
            map.on('click', function(e) {
              equipmentPosition = [e.lnglat.getLng(),e.lnglat.getLat()];
              addMarker();
            });
        }
    }

    // 将点添加到地图上
    function addMarker() {
      if(drawType != '一级' && drawType != '二级'){
         svgPosition = {
            map: map,
            position: equipmentPosition,
            showPositionPoint: true
         }
         svgMarker(drawType);
      }else{
         solidpolylineArr.length>0 && dashedpolylineArr.length>0?drawPolyline():'';
      }
    }

    function drawPolyline(){
        var solidpolyline;
        var dashedpolyline;
        if(drawType == '一级'){
            solidpolyline = new AMap.Polyline({
              map:map,
              path : solidpolylineArr,
              strokeColor:'#80d8ff',
              strokeStyle: 'solid',
              zIndex: 50,
              offset: [-12.5, -12.5],
            })
            map.add(solidpolyline);
        }
        if(drawType == '二级'){
            dashedpolyline = new AMap.Polyline({
              map:map,
              path : dashedpolylineArr,
              strokeColor:'#80d8ff',
              strokeStyle: 'dashed',
              zIndex: 50,
              offset: [-12.5, -12.5],
            })
            map.add(dashedpolyline);
        }
    }

    //每个点的点击事件
    function markerClick(e) {
        // var point = [e.lnglat.lng,e.lnglat.lat];?//这是在获取鼠标点击的坐标
        var point = [e.target.B.position.lng,e.target.B.position.lat];
        drawType == '一级'?solidpolylineArr.push(point):dashedpolylineArr.push(point)
        drawPolyline();

    }

    //==========================清除和关闭=============================
    document.getElementById('clear').onclick = function(){
        map.remove(overlays)
        overlays = [];
    }
    document.getElementById('close').onclick = function(){
        // mouseTool.close(true)//关闭，并清除覆盖物
        for(var i=0;i<radios.length;i+=1){
            radios[i].checked = false;
        }
    }

    </script>
  </body>
</html>
