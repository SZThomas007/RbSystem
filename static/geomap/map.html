<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" type="text/css">
    <link rel="stylesheet" href="../css/geoStyle.css" type="text/css">
    <style>
      html,body,#container{
        height: 100%
      }
      .input-item{
        height: 2.2rem;
      }
      .btn{
        width: 6rem;
        margin: 0 1rem 0 2rem;
      }
      .input-text{
        width: 4rem;
        margin-right:1rem;
      }

      #map-styles .input-item {
        height: 2rem;
      }

      #map-styles .input-item span{
        display: inline-block;
        width: 4rem;
      }

      #map-styles .input-item .input-text {
        color: #0288d1;
        margin-left: 1rem;
        margin-right: 0rem;
        width: 6rem;
      }

      .imgstyle{
        width: 22px;
        height: 23px;
      }
      /* 滑动特效 */
      .animationbtn{
        display: inline-block;
        width: 40px;
        height: 20px;
      }
     .background{
        position: fixed;
        bottom: 10rem;
        right: -14rem;
      }

     /* .amap-icon img:hover{
        width:25px;
        height: 25px;
      } */

     /* .amap-icon img{transition:all 0.3s;}
      .amap-icon img:hover{transfrom:scale{2,2};} */

      /* .background:hover{
         outline: none;
         animation:mymove 5s infinite;
        -webkit-animation:mymove 5s infinite;
      }
      .background:active{
         animation:none;
      }

      @keyframes mymove
      {
        from {right:-14rem;}
        to {right:1rem;}
      }

      @-webkit-keyframes mymove
      {
        from {right:-14rem;}
        to {right:1rem;}
      } */

    </style>
    <title>鼠标工具绘制</title>
  </head>
  <body>
    <!-- 翻转---等待原型 -->
    <!-- <div class="flip-container" ontouchstart="this.classList.toggle('hover');">
        <div class="flippable appcon ac-bicycle">
            <div class="front">
                <span>B</span>
                <i class="fa fa-bicycle"></i>
            </div>
            <div class="back">
                Bicycle
            </div>
        </div>
    </div> -->
    <!-- 地图 -->
    <div id='container'></div>
    <!-- <div class='info'>操作说明：圆和矩形通过拖拽来绘制，其他覆盖物通过点击来绘制</div> -->
    <!-- 图层控制 -->
    <div class="info">
        <input id="" type="button" class="btn" value="添加图层"  onclick="addLayer()"/>
        <input id="" type="button" class="btn" value="移除图层"   onclick="rmLayer()"/>
    </div>

    <!-- MouseTool绘制 -->
    <div class="input-card" style='width: 24rem;'>
        <div class="input-item">
          <input type="radio" name='func'  value='position'><span class="input-text"><img src="../image/定位.png" class="imgstyle" alt=""></span>
          <input type="radio" name='func'  value='jingshi'><span class="input-text"><img src="../image/井室.png" class="imgstyle" alt=""></span>
          <input type="radio" name='func'  value='famen'><span class="input-text"><img src="../image/阀门.png" class="imgstyle" alt=""></span>
        </div>
        <div class="input-item">
          <input type="radio" name='func' value='polyline'><span class="input-text"><img src="../image/直线.png" class="imgstyle" alt=""></span>
          <input type="radio" name='func' value='rectangle'><span class="input-text"><img src="../image/矩形框.png" class="imgstyle" alt=""></span>
          <input type="radio" name='func' value='circle'><span class="input-text"><img src="../image/圆形.png" class="imgstyle" alt=""></span>
        </div>
        <div class="input-item">
            <input id="clear" type="button" class="btn" value="清除" />
            <input id="close" type="button" class="btn" value="关闭绘图" />
        </div>
    </div>

    <!-- 换肤动画-->
    <div id="volet_clos">
      <div id="volet">
         <div id="map-styles">
           <div class="input-item"><input type='radio' name='mapStyle' value='dark' ><span>幻影黑</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='light'><span>月光银</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='whitesmoke' checked><span>远山黛</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='fresh'><span>草色青</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='grey'><span>雅士灰</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='graffiti'><span>涂鸦</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='macaron'><span>马卡龙</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='blue'><span>靛青蓝</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='darkblue'><span>极夜蓝</span></div>
           <div class="input-item"><input type='radio' name='mapStyle' value='wine'><span>酱籽</span></div>
         </div>
        <a href="#volet" class="ouvrir" aria-hidden="true">换肤</a>
        <a href="#volet_clos" class="fermer" aria-hidden="true">收起</a>
      </div>
    </div>

    <!-- 换肤normal-->
    <!-- <div class="background input-card" style="width:15rem">
        <span class="animationbtn">收起</span>
        <div id="map-styles">
          <div class="input-item"><input type='radio' name='mapStyle' value='dark' ><span>幻影黑</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='light'><span>月光银</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='whitesmoke' checked><span>远山黛</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='fresh'><span>草色青</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='grey'><span>雅士灰</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='graffiti'><span>涂鸦</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='macaron'><span>马卡龙</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='blue'><span>靛青蓝</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='darkblue'><span>极夜蓝</span></div>
          <div class="input-item"><input type='radio' name='mapStyle' value='wine'><span>酱籽</span></div>
        </div>
    </div> -->

    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="https://webapi.amap.com/maps?v=1.4.15&key=486bdaf9ff24488ff9064da3f3da77b1&plugin=AMap.MouseTool"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script src="../js/jquery-3.4.1.min.js"></script>

    <!-- UI组件库 1.0 -->
    <script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
    <!-- 预加载iconfont的js -->
    <script src="../js/iconfont.js"></script>
    <script type="text/javascript">
    // 翻转
    // $(".flippable").click(function() {
    //     $(this).toggleClass("flipme");
    // });

    // =====================图片图层======================
    var imageLayer = new AMap.ImageLayer({
        url: '../image/bg.png',
        bounds: new AMap.Bounds(
            [116.429697,39.853614],
            [116.617838,39.908808]
        ),
        zooms: [5,20]
    });
    // =====================创建地图======================
    var markers,map = new AMap.Map('container',{
        zoom: 13,
        center: [116.53381,39.88339],
        resizeEnable: true,
        mapStyle: "amap://styles/whitesmoke" ,//地图换肤样式
        layers: [
            new AMap.TileLayer(),
            imageLayer
        ]
    });




    // =====================控制图层的显示和隐藏======================
    function addLayer() {
        imageLayer.setMap(map);
    }
    function rmLayer() {
        imageLayer.setMap(null);
    }

    //====================为地图换肤=======================
    //绑定radio点击事件
    var radios = document.querySelectorAll("#map-styles input");
    radios.forEach(function(ratio) {
      ratio.onclick = setMapStyle;
    });
    function setMapStyle() {
      var styleName = "amap://styles/" + this.value;
      map.setMapStyle(styleName);
    }


    //=====================鼠标绘制工具=====================
    var mouseTool = new AMap.MouseTool(map);
    //监听draw事件可获取画好的覆盖物
    var overlays = [];
    mouseTool.on('draw',function(e){
        overlays.push(e.obj);
        console.log(e)
    })
    //监控多边形绘制工具mouseTool，获取绘制的坐标点
    AMap.event.addListener(mouseTool, 'draw', function(type,obj) {
        console.log(type,obj);
        if(type.obj.CLASS_NAME != "AMap.Marker"){
            var polygonItem = type.obj;
            var path = polygonItem.getPath();//取得绘制的多边形的每一个点坐标
            console.log(path);
            $.ajax({
                url:'/map/getPipeline',
                type:"post",
                data: JSON.stringify(path),
                dataType: 'json',
                contentType : 'application/json',
                success:function(data){
                    var result = data.result;
                    var path=[];
                    for(var item in result){
                       path.push([result[item].lng,result[item].lat])
                    }
                    var polyline = new AMap.Polyline({
                        path : path,
                    })
                    map.add(polyline);
                }.bind(this),
                error:function(){
                    alert("请求失败");
                }
            });
        }
    });

    function draw(type){
      switch(type){
        case 'position':{
            mouseTool.marker({
              //同Marker的Option设置
              icon: "../image/定位.png",
              offset: new AMap.Pixel(-15, -15)
            });
            break;
        }
        case 'jingshi':{
            mouseTool.marker({
              //同Marker的Option设置
              icon: "../image/井室.png",
              offset: new AMap.Pixel(-15, -15)
            });
            break;
        }
        case 'famen':{
            mouseTool.marker({
              //同Marker的Option设置
              icon: "../image/阀门.png",
              offset: new AMap.Pixel(-15, -15)
            });
            break;
        }
        case 'polyline':{
            mouseTool.polyline({
              strokeColor:'#25A5F7',
              strokeOpacity: 1,
              strokeWeight: 4,
              //同Polyline的Option设置
            });
            break;
        }
        case 'polygon':{
            mouseTool.polygon({
              strokeColor: "#E02433",
              strokeOpacity: 1,
              strokeWeight: 6,
              strokeOpacity: 0.2,
              fillColor: '#1791fc',
              fillOpacity: 0.4,
              // 线样式还支持 'dashed'
              strokeStyle: "solid",
              // strokeStyle是dashed时有效
              // strokeDasharray: [30,10],
            });
            break;
        }
        case 'rectangle':{
            mouseTool.rectangle({
              fillColor:'#00b0ff',
              strokeColor:'#80d8ff'
              //同Polygon的Option设置
            });
            break;
        }
        case 'circle':{
            mouseTool.circle({
              fillColor:'#00b0ff',
              strokeColor:'#80d8ff'
              //同Circle的Option设置
            });
            break;
        }
      }
    }
    // markers.on('click', markerClick);

    var radios = document.getElementsByName('func');
    for(var i=0;i<radios.length;i+=1){
        radios[i].onchange = function(e){
          draw(e.target.value)
        }
    }
    draw();
    document.getElementById('clear').onclick = function(){
        map.remove(overlays)
        overlays = [];
    }
    document.getElementById('close').onclick = function(){
        // mouseTool.close(true)//关闭，并清除覆盖物
        for(var i=0;i<radios.length;i+=1){
            radios[i].checked = false;
        }
    }

    //==================动态为地图添加图片坐标点=============
    var jsMarker =[{
        station_Id: '1',
        station_Name: '合康变频充电站',
        station_Num: 60,
        address: [116.47802, 39.888923]
      }, {
        station_Id: '2',
        station_Name: '中润通充电站',
        station_Num: 30,
        address: [116.5793, 39.864971]
      }, {
        station_Id: '3',
        station_Name: '家乐福充电站',
        station_Num: 23,
        address: [116.577927, 39.857567]
      }, {
        station_Id: '4',
        station_Name: '嘉捷充电站',
        station_Num: 12,
        address: [116.482827, 39.857831]
      }];

    var jingshi;
    for (var i = 0;i<jsMarker.length;i++) {
        if(jsMarker[i].station_Id=="1"){
          jingshi = new AMap.Marker({
               icon: "../image/定位.png",
               position: jsMarker[i].address,
               offset: new AMap.Pixel(-11, -12)
           });
        }else{
          jingshi = new AMap.Marker({
              icon: "../image/管网设备.png",
              position: jsMarker[i].address,
              offset: new AMap.Pixel(-11, -12),
              lnglat:jsMarker[i].address,
          });
        }
        jingshi.setMap(map);//将标记图片加到地图
        jingshi.on('click', markerClick);

        // jingshi.on('mouseover ', markerClick);
    }
    //监控鼠标缩放事件
    map.on('mousewheel',function(e){
       // console.log(e);
       // console.log(path);
       // console.log("jingshi",jingshi)
    })

    //每个监控点 点击事件
    var path=[];
    function markerClick(e) {
        console.log(e, 'mark info');
        var positions=[];
        positions.push(e.target.B.position.lng,e.target.B.position.lat)
        path.push(positions)
        //模拟画线
        // mouseTool.polyline({
        //  strokeColor:'#25A5F7',
        //  strokeOpacity: 1,
        //  strokeWeight: 4,
        //  //同Polyline的Option设置
        // });
       console.log("position",positions);
       if(positions.length==2){
           var polyline = new AMap.Polyline({
              map:map,
              path : path,
              isOutline: true,
              outlineColor: '#ffeeff',
              borderWeight: 3,
              strokeColor: "#3366FF",
              strokeOpacity: 1,
              strokeWeight: 3,
              // 折线样式还支持 'dashed'
              strokeStyle: "solid",
              // strokeStyle是dashed时有效
              strokeDasharray: [10, 5],
              lineJoin: 'round',
              lineCap: 'round',
              zIndex: 50,
              // offset: new AMap.Pixel(13, 30)
           })
           map.add(polyline);
       }

    }
    //====================通过数据加载绘制折线图=============================
    // var path = [new AMap.LngLat(116,39), new AMap.LngLat(116,40), new AMap.LngLat(117,39)] //标准写法
    // var path = [ [116,39], [116,40], [117,39] ]; //简写
    // var polyline = new AMap.Polyline({
    //     path : path,
    // })
    // map.add(polyline);

    //========================ajax请求=================================
    //绘制折线
//     $.ajax({
//         url:'/map/getPipeline',
//         type:"get",
//         dataType: 'json',
//         contentType : 'application/json',
//         success:function(data){
//             var result = data.result;
//             var path=[];
//             for(var item in result){
//                path.push([result[item].lng,result[item].lat])
//             }
//             var polyline = new AMap.Polyline({
//                 path : path,
//             })
//             map.add(polyline);
//         }.bind(this),
//         error:function(){
//             alert("请求失败");
//         }
//     });



    </script>
  </body>
</html>
